<!DOCTYPE html>
<html>
<head>
  <title>Getting Referral...</title>
  <meta charset="UTF-8">
  <script>
    // STEP 1: Get ref from URL
    const urlParams = new URLSearchParams(window.location.search);
    const ref = urlParams.get('ref');

    if (ref) {
      // Save to localStorage
      localStorage.setItem('ReferralCode', ref);
    }

    // STEP 2: Decide which referral code to use
    const finalRef = ref || localStorage.getItem('ReferralCode') || "";

    // STEP 3: Send to Kodular if inside WebViewer
    function sendToKodular(refCode) {
      if (window.AppInventor && window.AppInventor.setWebViewString) {
        window.AppInventor.setWebViewString(refCode);
      }
    }

    // Wait for page to fully load before sending
    window.onload = function () {
      sendToKodular(finalRef);
    };
  </script>
</head>
<body>
  <p style="text-align:center;margin-top:50px;">Reading Referral Code...</p>
</body>
</html>
