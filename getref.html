<!DOCTYPE html>
<html>
<head>
  <title>Referral Loader</title>
  <script>
    window.onload = function () {
      let urlParams = new URLSearchParams(window.location.search);
      let ref = urlParams.get('ref');

      if (ref) {
        localStorage.setItem('ReferralCode', ref);
        alert('Referral in getref.html: ' + ref);
        if (window.AppInventor) {
          window.AppInventor.setWebViewString(ref);
        } else {
          alert("AppInventor object not available");
        }
      } else {
        // No ?ref= in URL, try from localStorage
        let storedRef = localStorage.getItem('ReferralCode');
        if (storedRef) {
          alert('Referral from localStorage: ' + storedRef);
          if (window.AppInventor) {
            window.AppInventor.setWebViewString(storedRef);
          } else {
            alert("AppInventor object not available");
          }
        } else {
          // No referral found at all
          if (window.AppInventor) {
            window.AppInventor.setWebViewString("");
          }
        }
      }
    };
  </script>
</head>
<body>
  Reading Referral Code...
</body>
</html>
